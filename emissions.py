# -*- coding: utf-8 -*-
"""junk

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1pa4vCdoIkqxQu8Rf_koLAZ6thZQtcRZ_
"""

#Dataset link: https://www.fao.org/faostat/en/#data/FBS

import numpy as np
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

data = pd.read_csv("/content/FAOSTAT_data_en_6-5-2023.csv", encoding="ISO-8859-1")

data.shape

data.head()

# Get column names
data.columns

data['Area'].value_counts()

#types of emission
data['Element'].value_counts()

#types of Units
data['Unit'].value_counts()

# Check the summary statistics of the dataset
data.describe()

# Check the information about the dataset, including data types and missing values
data.info()

#Maximum emission from
data.sort_values(by=['Value']).tail(5)

data.shape

# Top CH4 emissions
ch4_data = data[data['Element'] == 'Emissions (CH4)']

ch4_by_country = ch4_data.groupby('Area')['Value'].sum()

# top 10 countries
top_10_ch4_countries = ch4_by_country.sort_values(ascending=False).head(10)

# Plot a horizontal bar
plt.barh(top_10_ch4_countries.index, top_10_ch4_countries)
plt.xlabel('CH4 Emissions')
plt.ylabel('Country')
plt.title('Top 10 CH4 Emissions by Country')
plt.show()

# Top CH4 emissions
ch4_data = data[data['Element'] == 'Emissions (CO2eq) (AR5)']

ch4_by_country = ch4_data.groupby('Area')['Value'].sum()

# top 10 countries
top_10_ch4_countries = ch4_by_country.sort_values(ascending=False).head(10)

# Plot a horizontal bar
plt.barh(top_10_ch4_countries.index, top_10_ch4_countries)
plt.xlabel('CO2eq Emissions')
plt.ylabel('Country')
plt.title('Top 10 CO2eq Emissions by Country')
plt.show()

#types of items emission wise
item_counts = data['Item'].value_counts()

# Plot a histogram of the item counts
plt.bar(item_counts.index, item_counts)
plt.xlabel('Item')
plt.ylabel('Count')
plt.title('Item Emission Counts')
plt.xticks(rotation=90)
plt.show()

# Check for missing values
print(data.isnull().sum())

"""To create a regression machine learning model to predict the value column in the given dataset, we can follow these steps:

Step 1: Data Preparation
- Import the necessary libraries such as pandas, numpy, and scikit-learn.
- Load the dataset into a pandas DataFrame.
- Perform any required data preprocessing steps such as handling missing values, converting categorical variables, and scaling numerical features if necessary.
- Split the dataset into features (input) and target (output) variables.

Step 2: Feature Engineering
- If required, perform feature engineering to extract relevant features from the existing data. This step may involve creating new features, transforming variables, or selecting subsets of features.

Step 3: Model Training and Evaluation
- Split the dataset into training and testing sets.
- Choose a regression model suitable for the problem, such as linear regression, decision tree regressor, or random forest regressor.
- Train the regression model using the training data.
- Evaluate the model's performance using appropriate metrics such as mean squared error (MSE), mean absolute error (MAE), or R-squared score.
- Iterate and experiment with different models or hyperparameters to improve performance.

Step 4: Prediction
- Once you have trained and selected the best-performing model, use it to make predictions on the unseen testing data.
- Assess the performance of the model based on prediction accuracy and error metrics.
- Optionally, you can deploy the model to make predictions on new, unseen data in the future.

Please note that the provided dataset appears to have only a few records and may not be sufficient to build an accurate regression model. Having more data would generally result in better model performance. Additionally, it's essential to have a better understanding of the dataset's context and the specific problem you're trying to solve to make more informed decisions during the model building process.
"""

data.columns

import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.tree import DecisionTreeRegressor
from sklearn.ensemble import RandomForestRegressor
from sklearn.metrics import mean_squared_error, mean_absolute_error
from sklearn.preprocessing import LabelEncoder

# Splitting the dataset into features (X) and target (y)
X = data.drop(columns=['Value'])
y = data['Value']

# Step 2: Feature Engineering

# Columns to be one-hot encoded
one_hot_cols = ['Domain', 'Area', 'Element', 'Item', 'Source','Flag']

# Columns to be label encoded
label_encode_cols = ['Area Code (M49)', 'Year Code', 'Source Code']

# One-hot encoding
df_encoded = pd.get_dummies(data, columns=one_hot_cols)

# Label encoding
label_encoder = LabelEncoder()
for col in label_encode_cols:
    df_encoded[col] = label_encoder.fit_transform(df_encoded[col])

# Splitting the dataset into features (X) and target (y)
X = df_encoded.drop(columns=['Value','ï»¿Domain Code','Unit','Flag Description','Note'])
y = df_encoded['Value']

X

# Step 3: Model Training and Evaluation
# Splitting the dataset into training and testing sets
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# Linear Regression
linear_model = LinearRegression()
linear_model.fit(X_train, y_train)

# Decision Tree Regressor
dt_model = DecisionTreeRegressor(random_state=123)
dt_model.fit(X_train, y_train)

# Random Forest Regressor
rf_model = RandomForestRegressor(random_state=123)
rf_model.fit(X_train, y_train)

# Evaluating the models
models = {'Linear Regression': linear_model,
          'Decision Tree Regressor': dt_model,
          'Random Forest Regressor': rf_model}

results = {}
for name, model in models.items():
    y_train_pred = model.predict(X_train)
    y_test_pred = model.predict(X_test)
    train_mse = mean_squared_error(y_train, y_train_pred)
    train_mae = mean_absolute_error(y_train, y_train_pred)
    test_mse = mean_squared_error(y_test, y_test_pred)
    test_mae = mean_absolute_error(y_test, y_test_pred)
    results[name] = {'Train MSE': train_mse,
                     'Train MAE': train_mae,
                     'Test MSE': test_mse,
                     'Test MAE': test_mae}

# Comparing the models
for name, metrics in results.items():
    print(name + ":")
    print("Train MSE:", metrics['Train MSE'])
    print("Train MAE:", metrics['Train MAE'])
    print("Test MSE:", metrics['Test MSE'])
    print("Test MAE:", metrics['Test MAE'])
    print()

# Finding the best model based on metrics
best_model = min(results, key=lambda x: results[x]['Test MSE'])
print("Best Model:", best_model)

"""It's important to note that these metrics alone may not provide a complete understanding of model performance. It's always a good practice to consider additional evaluation metrics and perform further analysis, such as visualizing the actual vs. predicted values or assessing model assumptions, to gain a comprehensive understanding of how well the model is doing.

Let's perform further analysis and visualization of the actual vs. predicted values for the best model, the Random Forest Regressor.
"""

import matplotlib.pyplot as plt

# Getting the predicted values for the test set
y_pred = rf_model.predict(X_test)

# Scatter plot of actual vs. predicted values
plt.scatter(y_test, y_pred, color='blue')
plt.plot([y_test.min(), y_test.max()], [y_test.min(), y_test.max()], color='red', linestyle='--')
plt.xlabel('Actual Values')
plt.ylabel('Predicted Values')
plt.title('Random Forest Regressor: Actual vs. Predicted')
plt.show()

"""Scatter plot for Linear Regression"""

import matplotlib.pyplot as plt

# Scatter plot for Linear Regression
plt.scatter(y_test, linear_model.predict(X_test), color='blue', label='Linear Regression')
plt.xlabel('Actual Values')
plt.ylabel('Predicted Values')
plt.title('Linear Regression: Actual vs. Predicted')
plt.legend()
plt.show()

# Residual plot for Decision Tree Regressor
residuals_dt = y_test - dt_model.predict(X_test)
plt.scatter(y_test, residuals_dt, color='green', label='Decision Tree Regressor')
plt.axhline(y=0, color='red', linestyle='--')
plt.xlabel('Actual Values')
plt.ylabel('Residuals')
plt.title('Decision Tree Regressor: Residual Plot')
plt.legend()
plt.show()

"""# Live Demo of a input to get emission value"""

# Example input values


input_values = {
  "Area Code (M49)": 227,
  "Element Code": 7225,
  "Item Code": 6818,
  "Year Code": 5,
  "Year": 2045,
  "Source Code": 0,
  "Domain_Emissions totals": 1,
  "Area_Afghanistan": 0,
  "Area_Albania": 0,
  "Area_Algeria": 0,
  "Area_American Samoa": 0,
  "Area_Andorra": 0,
  "Area_Angola": 0,
  "Area_Anguilla": 0,
  "Area_Antigua and Barbuda": 0,
  "Area_Argentina": 0,
  "Area_Armenia": 0,
  "Area_Aruba": 0,
  "Area_Australia": 0,
  "Area_Austria": 0,
  "Area_Azerbaijan": 0,
  "Area_Bahamas": 0,
  "Area_Bahrain": 0,
  "Area_Bangladesh": 0,
  "Area_Barbados": 0,
  "Area_Belarus": 0,
  "Area_Belgium": 0,
  "Area_Belize": 0,
  "Area_Benin": 0,
  "Area_Bermuda": 0,
  "Area_Bhutan": 0,
  "Area_Bolivia (Plurinational State of)": 0,
  "Area_Bosnia and Herzegovina": 0,
  "Area_Botswana": 0,
  "Area_Brazil": 0,
  "Area_British Virgin Islands": 0,
  "Area_Brunei Darussalam": 0,
  "Area_Bulgaria": 0,
  "Area_Burkina Faso": 0,
  "Area_Burundi": 0,
  "Area_Cabo Verde": 0,
  "Area_Cambodia": 0,
  "Area_Cameroon": 0,
  "Area_Canada": 0,
  "Area_Cayman Islands": 0,
  "Area_Central African Republic": 0,
  "Area_Chad": 0,
  "Area_Channel Islands": 0,
  "Area_Chile": 0,
  "Area_China": 1,
  "Area_China, Hong Kong SAR": 0,
  "Area_China, Macao SAR": 0,
  "Area_China, Taiwan Province of": 0,
  "Area_China, mainland": 0,
  "Area_Colombia": 0,
  "Area_Comoros": 0,
  "Area_Congo": 0,
  "Area_Cook Islands": 0,
  "Area_Costa Rica": 0,
  "Area_Croatia": 0,
  "Area_Cuba": 0,
  "Area_Cyprus": 0,
  "Area_Czechia": 0,
  "Area_CÃ´te d'Ivoire": 0,
  "Area_Democratic People's Republic of Korea": 0,
  "Area_Democratic Republic of the Congo": 0,
  "Area_Denmark": 0,
  "Area_Djibouti": 0,
  "Area_Dominica": 0,
  "Area_Dominican Republic": 0,
  "Area_Ecuador": 0,
  "Area_Egypt": 0,
  "Area_El Salvador": 0,
  "Area_Equatorial Guinea": 0,
  "Area_Eritrea": 0,
  "Area_Estonia": 0,
  "Area_Eswatini": 0,
  "Area_Ethiopia": 0,
  "Area_Falkland Islands (Malvinas)": 0,
  "Area_Faroe Islands": 0,
  "Area_Fiji": 0,
  "Area_Finland": 0,
  "Area_France": 0,
  "Area_French Guiana": 0,
  "Area_French Polynesia": 0,
  "Area_Gabon": 0,
  "Area_Gambia": 0,
  "Area_Georgia": 0,
  "Area_Germany": 0,
  "Area_Ghana": 0,
  "Area_Gibraltar": 0,
  "Area_Greece": 0,
  "Area_Greenland": 0,
  "Area_Grenada": 0,
  "Area_Guadeloupe": 0,
  "Area_Guam": 0,
  "Area_Guatemala": 0,
  "Area_Guinea": 0,
  "Area_Guinea-Bissau": 0,
  "Area_Guyana": 0,
  "Area_Haiti": 0,
  "Area_Holy See": 0,
  "Area_Honduras": 0,
  "Area_Hungary": 0,
  "Area_Iceland": 0,
  "Area_India": 0,
  "Area_Indonesia": 0,
  "Area_Iran (Islamic Republic of)": 0,
  "Area_Iraq": 0,
  "Area_Ireland": 0,
  "Area_Isle of Man": 0,
  "Area_Israel": 0,
  "Area_Italy": 0,
  "Area_Jamaica": 0,
  "Area_Japan": 0,
  "Area_Jordan": 0,
  "Area_Kazakhstan": 0,
  "Area_Kenya": 0,
  "Area_Kiribati": 0,
  "Area_Kuwait": 0,
  "Area_Kyrgyzstan": 0,
  "Area_Lao People's Democratic Republic": 0,
  "Area_Latvia": 0,
  "Area_Lebanon": 0,
  "Area_Lesotho": 0,
  "Area_Liberia": 0,
  "Area_Libya": 0,
  "Area_Liechtenstein": 0,
  "Area_Lithuania": 0,
  "Area_Luxembourg": 0,
  "Area_Madagascar": 0,
  "Area_Malawi": 0,
  "Area_Malaysia": 0,
  "Area_Maldives": 0,
  "Area_Mali": 0,
  "Area_Malta": 0,
  "Area_Marshall Islands": 0,
  "Area_Martinique": 0,
  "Area_Mauritania": 0,
  "Area_Mauritius": 0,
  "Area_Mayotte": 0,
  "Area_Mexico": 0,
  "Area_Micronesia (Federated States of)": 0,
  "Area_Monaco": 0,
  "Area_Mongolia": 0,
  "Area_Montenegro": 0,
  "Area_Montserrat": 0,
  "Area_Morocco": 0,
  "Area_Mozambique": 0,
  "Area_Myanmar": 0,
  "Area_Namibia": 0,
  "Area_Nauru": 0,
  "Area_Nepal": 0,
  "Area_Netherlands (Kingdom of the)": 0,
  "Area_Netherlands Antilles (former)": 0,
  "Area_New Caledonia": 0,
  "Area_New Zealand": 0,
  "Area_Nicaragua": 0,
  "Area_Niger": 0,
  "Area_Nigeria": 0,
  "Area_Niue": 0,
  "Area_North Macedonia": 0,
  "Area_Northern Mariana Islands": 0,
  "Area_Norway": 0,
  "Area_Oman": 0,
  "Area_Pakistan": 0,
  "Area_Palau": 0,
  "Area_Palestine": 0,
  "Area_Panama": 0,
  "Area_Papua New Guinea": 0,
  "Area_Paraguay": 0,
  "Area_Peru": 0,
  "Area_Philippines": 0,
  "Area_Poland": 0,
  "Area_Portugal": 0,
  "Area_Puerto Rico": 0,
  "Area_Qatar": 0,
  "Area_Republic of Korea": 0,
  "Area_Republic of Moldova": 0,
  "Area_Romania": 0,
  "Area_Russian Federation": 0,
  "Area_Rwanda": 0,
  "Area_RÃ©union": 0,
  "Area_Saint Helena, Ascension and Tristan da Cunha": 0,
  "Area_Saint Kitts and Nevis": 0,
  "Area_Saint Lucia": 0,
  "Area_Saint Pierre and Miquelon": 0,
  "Area_Saint Vincent and the Grenadines": 0,
  "Area_Samoa": 0,
  "Area_San Marino": 0,
  "Area_Sao Tome and Principe": 0,
  "Area_Saudi Arabia": 0,
  "Area_Senegal": 0,
  "Area_Serbia": 0,
  "Area_Seychelles": 0,
  "Area_Sierra Leone": 0,
  "Area_Singapore": 0,
  "Area_Slovakia": 0,
  "Area_Slovenia": 0,
  "Area_Solomon Islands": 0,
  "Area_Somalia": 0,
  "Area_South Africa": 0,
  "Area_South Sudan": 0,
  "Area_Spain": 0,
  "Area_Sri Lanka": 0,
  "Area_Sudan": 0,
  "Area_Sudan (former)": 0,
  "Area_Suriname": 0,
  "Area_Sweden": 0,
  "Area_Switzerland": 0,
  "Area_Syrian Arab Republic": 0,
  "Area_Tajikistan": 0,
  "Area_Thailand": 0,
  "Area_Timor-Leste": 0,
  "Area_Togo": 0,
  "Area_Tokelau": 0,
  "Area_Tonga": 0,
  "Area_Trinidad and Tobago": 0,
  "Area_Tunisia": 0,
  "Area_Turkmenistan": 0,
  "Area_Turks and Caicos Islands": 0,
  "Area_Tuvalu": 0,
  "Area_TÃ¼rkiye": 0,
  "Area_Uganda": 0,
  "Area_Ukraine": 0,
  "Area_United Arab Emirates": 0,
  "Area_United Kingdom of Great Britain and Northern Ireland": 0,
  "Area_United Republic of Tanzania": 0,
  "Area_United States Virgin Islands": 0,
  "Area_United States of America": 0,
  "Area_Uruguay": 0,
  "Area_Uzbekistan": 0,
  "Area_Vanuatu": 0,
  "Area_Venezuela (Bolivarian Republic of)": 0,
  "Area_Viet Nam": 0,
  "Area_Wallis and Futuna Islands": 0,
  "Area_Yemen": 0,
  "Area_Zambia": 0,
  "Area_Zimbabwe": 0,
  "Element_Emissions (CH4)": 1,
  "Element_Emissions (CO2)": 0,
  "Element_Emissions (CO2eq) (AR5)": 0,
  "Element_Emissions (CO2eq) from CH4 (AR5)": 0,
  "Element_Emissions (CO2eq) from F-gases (AR5)": 0,
  "Element_Emissions (CO2eq) from N2O (AR5)": 0,
  "Element_Emissions (N2O)": 0,
  "Item_Agrifood Systems Waste Disposal": 0,
  "Item_Food Packaging": 0,
  "Item_Food Processing": 0,
  "Item_Food Retail": 0,
  "Item_Food Transport": 0,
  "Item_Waste": 1,
  "Source_FAO TIER 1": 1,
  "Flag_E": 1
}

# Create a DataFrame from the input values
input_df = pd.DataFrame(input_values, index=[0])

# Get the predicted value using the Random Forest Regressor model
predicted_value = rf_model.predict(input_df)

print("Predicted Emissions (CH4) in kilotones:", predicted_value)
print("in the year: " , input_df['Year'])

#Future Plan
#Emission forcasting dashboard
#to convert df to JSON
# out = X_train.head(1).to_json(orient='records')[1:-1].replace('},{', '} {')

# out

import pickle

pickle.dump(rf_model, open('model.pkl','wb'))

